{"ast":null,"code":"import axios from 'axios';\nimport jwtDefaultConfig from './jwtDefaultConfig';\nexport default class JwtService {\n  // ** jwtConfig <= Will be used by this service\n  // ** For Refreshing Token\n  // ** For Refreshing Token\n  constructor(jwtOverrideConfig) {\n    this.jwtConfig = { ...jwtDefaultConfig\n    };\n    this.isAlreadyFetchingAccessToken = false;\n    this.subscribers = [];\n    this.jwtConfig = { ...this.jwtConfig,\n      ...jwtOverrideConfig\n    }; // ** Request Interceptor\n\n    axios.interceptors.request.use(config => {\n      // ** Get token from localStorage\n      const accessToken = this.getToken(); // ** If token is present add it to request's Authorization Header\n\n      if (accessToken) {\n        // ** eslint-disable-next-line no-param-reassign\n        config.headers.Authorization = `${this.jwtConfig.tokenType} ${accessToken}`;\n      }\n\n      return config;\n    }, error => Promise.reject(error)); // ** Add request/response interceptor\n\n    axios.interceptors.response.use(response => response, error => {\n      // ** const { config, response: { status } } = error\n      const {\n        config,\n        response\n      } = error;\n      const originalRequest = config; // ** if (status === 401) {\n\n      if (response && response.status === 401) {\n        if (!this.isAlreadyFetchingAccessToken) {\n          this.isAlreadyFetchingAccessToken = true;\n          this.refreshToken().then(r => {\n            this.isAlreadyFetchingAccessToken = false; // ** Update accessToken in localStorage\n\n            this.setToken(r.data.accessToken);\n            this.setRefreshToken(r.data.refreshToken);\n            this.onAccessTokenFetched(r.data.accessToken);\n          });\n        }\n\n        const retryOriginalRequest = new Promise(resolve => {\n          this.addSubscriber(accessToken => {\n            // ** Make sure to assign accessToken according to your response.\n            // ** Check: https://pixinvent.ticksy.com/ticket/2413870\n            // ** Change Authorization header\n            originalRequest.headers.Authorization = `${this.jwtConfig.tokenType} ${accessToken}`;\n            resolve(this.axios(originalRequest));\n          });\n        });\n        return retryOriginalRequest;\n      }\n\n      return Promise.reject(error);\n    });\n  }\n\n  onAccessTokenFetched(accessToken) {\n    this.subscribers = this.subscribers.filter(callback => callback(accessToken));\n  }\n\n  addSubscriber(callback) {\n    this.subscribers.push(callback);\n  }\n\n  getToken() {\n    return localStorage.getItem(this.jwtConfig.storageTokenKeyName);\n  }\n\n  getRefreshToken() {\n    return localStorage.getItem(this.jwtConfig.storageRefreshTokenKeyName);\n  }\n\n  setToken(value) {\n    localStorage.setItem(this.jwtConfig.storageTokenKeyName, value);\n  }\n\n  setRefreshToken(value) {\n    localStorage.setItem(this.jwtConfig.storageRefreshTokenKeyName, value);\n  }\n\n  login() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return axios.post(this.jwtConfig.loginEndpoint, ...args);\n  }\n\n  register() {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    return axios.post(this.jwtConfig.registerEndpoint, ...args);\n  }\n\n  refreshToken() {\n    return axios.post(this.jwtConfig.refreshEndpoint, {\n      refreshToken: this.getRefreshToken()\n    });\n  }\n\n}","map":{"version":3,"sources":["/Users/jvledesma/Downloads/react-version/full-version/src/@core/auth/jwt/jwtService.js"],"names":["axios","jwtDefaultConfig","JwtService","constructor","jwtOverrideConfig","jwtConfig","isAlreadyFetchingAccessToken","subscribers","interceptors","request","use","config","accessToken","getToken","headers","Authorization","tokenType","error","Promise","reject","response","originalRequest","status","refreshToken","then","r","setToken","data","setRefreshToken","onAccessTokenFetched","retryOriginalRequest","resolve","addSubscriber","filter","callback","push","localStorage","getItem","storageTokenKeyName","getRefreshToken","storageRefreshTokenKeyName","value","setItem","login","args","post","loginEndpoint","register","registerEndpoint","refreshEndpoint"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,gBAAP,MAA6B,oBAA7B;AAEA,eAAe,MAAMC,UAAN,CAAiB;AAC9B;AAGA;AAGA;AAGAC,EAAAA,WAAW,CAACC,iBAAD,EAAoB;AAAA,SAR/BC,SAQ+B,GARnB,EAAE,GAAGJ;AAAL,KAQmB;AAAA,SAL/BK,4BAK+B,GALA,KAKA;AAAA,SAF/BC,WAE+B,GAFjB,EAEiB;AAC7B,SAAKF,SAAL,GAAiB,EAAE,GAAG,KAAKA,SAAV;AAAqB,SAAGD;AAAxB,KAAjB,CAD6B,CAG7B;;AACAJ,IAAAA,KAAK,CAACQ,YAAN,CAAmBC,OAAnB,CAA2BC,GAA3B,CACEC,MAAM,IAAI;AACR;AACA,YAAMC,WAAW,GAAG,KAAKC,QAAL,EAApB,CAFQ,CAIR;;AACA,UAAID,WAAJ,EAAiB;AACf;AACAD,QAAAA,MAAM,CAACG,OAAP,CAAeC,aAAf,GAAgC,GAAE,KAAKV,SAAL,CAAeW,SAAU,IAAGJ,WAAY,EAA1E;AACD;;AACD,aAAOD,MAAP;AACD,KAXH,EAYEM,KAAK,IAAIC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAZX,EAJ6B,CAmB7B;;AACAjB,IAAAA,KAAK,CAACQ,YAAN,CAAmBY,QAAnB,CAA4BV,GAA5B,CACEU,QAAQ,IAAIA,QADd,EAEEH,KAAK,IAAI;AACP;AACA,YAAM;AAAEN,QAAAA,MAAF;AAAUS,QAAAA;AAAV,UAAuBH,KAA7B;AACA,YAAMI,eAAe,GAAGV,MAAxB,CAHO,CAKP;;AACA,UAAIS,QAAQ,IAAIA,QAAQ,CAACE,MAAT,KAAoB,GAApC,EAAyC;AACvC,YAAI,CAAC,KAAKhB,4BAAV,EAAwC;AACtC,eAAKA,4BAAL,GAAoC,IAApC;AACA,eAAKiB,YAAL,GAAoBC,IAApB,CAAyBC,CAAC,IAAI;AAC5B,iBAAKnB,4BAAL,GAAoC,KAApC,CAD4B,CAG5B;;AACA,iBAAKoB,QAAL,CAAcD,CAAC,CAACE,IAAF,CAAOf,WAArB;AACA,iBAAKgB,eAAL,CAAqBH,CAAC,CAACE,IAAF,CAAOJ,YAA5B;AAEA,iBAAKM,oBAAL,CAA0BJ,CAAC,CAACE,IAAF,CAAOf,WAAjC;AACD,WARD;AASD;;AACD,cAAMkB,oBAAoB,GAAG,IAAIZ,OAAJ,CAAYa,OAAO,IAAI;AAClD,eAAKC,aAAL,CAAmBpB,WAAW,IAAI;AAChC;AACA;AACA;AACAS,YAAAA,eAAe,CAACP,OAAhB,CAAwBC,aAAxB,GAAyC,GAAE,KAAKV,SAAL,CAAeW,SAAU,IAAGJ,WAAY,EAAnF;AACAmB,YAAAA,OAAO,CAAC,KAAK/B,KAAL,CAAWqB,eAAX,CAAD,CAAP;AACD,WAND;AAOD,SAR4B,CAA7B;AASA,eAAOS,oBAAP;AACD;;AACD,aAAOZ,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACD,KAjCH;AAmCD;;AAEDY,EAAAA,oBAAoB,CAACjB,WAAD,EAAc;AAChC,SAAKL,WAAL,GAAmB,KAAKA,WAAL,CAAiB0B,MAAjB,CAAwBC,QAAQ,IAAIA,QAAQ,CAACtB,WAAD,CAA5C,CAAnB;AACD;;AAEDoB,EAAAA,aAAa,CAACE,QAAD,EAAW;AACtB,SAAK3B,WAAL,CAAiB4B,IAAjB,CAAsBD,QAAtB;AACD;;AAEDrB,EAAAA,QAAQ,GAAG;AACT,WAAOuB,YAAY,CAACC,OAAb,CAAqB,KAAKhC,SAAL,CAAeiC,mBAApC,CAAP;AACD;;AAEDC,EAAAA,eAAe,GAAG;AAChB,WAAOH,YAAY,CAACC,OAAb,CAAqB,KAAKhC,SAAL,CAAemC,0BAApC,CAAP;AACD;;AAEDd,EAAAA,QAAQ,CAACe,KAAD,EAAQ;AACdL,IAAAA,YAAY,CAACM,OAAb,CAAqB,KAAKrC,SAAL,CAAeiC,mBAApC,EAAyDG,KAAzD;AACD;;AAEDb,EAAAA,eAAe,CAACa,KAAD,EAAQ;AACrBL,IAAAA,YAAY,CAACM,OAAb,CAAqB,KAAKrC,SAAL,CAAemC,0BAApC,EAAgEC,KAAhE;AACD;;AAEDE,EAAAA,KAAK,GAAU;AAAA,sCAANC,IAAM;AAANA,MAAAA,IAAM;AAAA;;AACb,WAAO5C,KAAK,CAAC6C,IAAN,CAAW,KAAKxC,SAAL,CAAeyC,aAA1B,EAAyC,GAAGF,IAA5C,CAAP;AACD;;AAEDG,EAAAA,QAAQ,GAAU;AAAA,uCAANH,IAAM;AAANA,MAAAA,IAAM;AAAA;;AAChB,WAAO5C,KAAK,CAAC6C,IAAN,CAAW,KAAKxC,SAAL,CAAe2C,gBAA1B,EAA4C,GAAGJ,IAA/C,CAAP;AACD;;AAEDrB,EAAAA,YAAY,GAAG;AACb,WAAOvB,KAAK,CAAC6C,IAAN,CAAW,KAAKxC,SAAL,CAAe4C,eAA1B,EAA2C;AAChD1B,MAAAA,YAAY,EAAE,KAAKgB,eAAL;AADkC,KAA3C,CAAP;AAGD;;AAvG6B","sourcesContent":["import axios from 'axios'\r\nimport jwtDefaultConfig from './jwtDefaultConfig'\r\n\r\nexport default class JwtService {\r\n  // ** jwtConfig <= Will be used by this service\r\n  jwtConfig = { ...jwtDefaultConfig }\r\n\r\n  // ** For Refreshing Token\r\n  isAlreadyFetchingAccessToken = false\r\n\r\n  // ** For Refreshing Token\r\n  subscribers = []\r\n\r\n  constructor(jwtOverrideConfig) {\r\n    this.jwtConfig = { ...this.jwtConfig, ...jwtOverrideConfig }\r\n\r\n    // ** Request Interceptor\r\n    axios.interceptors.request.use(\r\n      config => {\r\n        // ** Get token from localStorage\r\n        const accessToken = this.getToken()\r\n\r\n        // ** If token is present add it to request's Authorization Header\r\n        if (accessToken) {\r\n          // ** eslint-disable-next-line no-param-reassign\r\n          config.headers.Authorization = `${this.jwtConfig.tokenType} ${accessToken}`\r\n        }\r\n        return config\r\n      },\r\n      error => Promise.reject(error)\r\n    )\r\n\r\n    // ** Add request/response interceptor\r\n    axios.interceptors.response.use(\r\n      response => response,\r\n      error => {\r\n        // ** const { config, response: { status } } = error\r\n        const { config, response } = error\r\n        const originalRequest = config\r\n\r\n        // ** if (status === 401) {\r\n        if (response && response.status === 401) {\r\n          if (!this.isAlreadyFetchingAccessToken) {\r\n            this.isAlreadyFetchingAccessToken = true\r\n            this.refreshToken().then(r => {\r\n              this.isAlreadyFetchingAccessToken = false\r\n\r\n              // ** Update accessToken in localStorage\r\n              this.setToken(r.data.accessToken)\r\n              this.setRefreshToken(r.data.refreshToken)\r\n\r\n              this.onAccessTokenFetched(r.data.accessToken)\r\n            })\r\n          }\r\n          const retryOriginalRequest = new Promise(resolve => {\r\n            this.addSubscriber(accessToken => {\r\n              // ** Make sure to assign accessToken according to your response.\r\n              // ** Check: https://pixinvent.ticksy.com/ticket/2413870\r\n              // ** Change Authorization header\r\n              originalRequest.headers.Authorization = `${this.jwtConfig.tokenType} ${accessToken}`\r\n              resolve(this.axios(originalRequest))\r\n            })\r\n          })\r\n          return retryOriginalRequest\r\n        }\r\n        return Promise.reject(error)\r\n      }\r\n    )\r\n  }\r\n\r\n  onAccessTokenFetched(accessToken) {\r\n    this.subscribers = this.subscribers.filter(callback => callback(accessToken))\r\n  }\r\n\r\n  addSubscriber(callback) {\r\n    this.subscribers.push(callback)\r\n  }\r\n\r\n  getToken() {\r\n    return localStorage.getItem(this.jwtConfig.storageTokenKeyName)\r\n  }\r\n\r\n  getRefreshToken() {\r\n    return localStorage.getItem(this.jwtConfig.storageRefreshTokenKeyName)\r\n  }\r\n\r\n  setToken(value) {\r\n    localStorage.setItem(this.jwtConfig.storageTokenKeyName, value)\r\n  }\r\n\r\n  setRefreshToken(value) {\r\n    localStorage.setItem(this.jwtConfig.storageRefreshTokenKeyName, value)\r\n  }\r\n\r\n  login(...args) {\r\n    return axios.post(this.jwtConfig.loginEndpoint, ...args)\r\n  }\r\n\r\n  register(...args) {\r\n    return axios.post(this.jwtConfig.registerEndpoint, ...args)\r\n  }\r\n\r\n  refreshToken() {\r\n    return axios.post(this.jwtConfig.refreshEndpoint, {\r\n      refreshToken: this.getRefreshToken()\r\n    })\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}